# -*- mode: ruby -*-
require 'autotest/redgreen'
# require 'autotest/rspec'

if ENV['OSTYPE'] == 'darwin'
  module Autotest::Growl
    def self.growl title, msg, img, pri=0, stick=""
      system "growlnotify -n autotest --image #{img} -p #{pri} -m #{msg.inspect} #{title} #{stick}"
    end

    Autotest.add_hook :ran_command do |at|
      begin
        output = at.results[-1].strip
      rescue NoMethodError
        next
      end

      unless output =~ /0 failure/
        growl "Test Results", "#{output}", File.join(File.dirname(__FILE__), '.pix', 'thumb_fail.png'), 2
      else
        growl "Test Results", "#{output}", File.join(File.dirname(__FILE__), '.pix', 'thumb_ok.png')
      end
    end
  end
end

