#!/usr/bin/env python

from itertools import islice
import json
import os
import sys

def window(seq, n=2):
    "Returns a sliding window (of width n) over data from the iterable"
    "   s -> (s0,s1,...s[n-1]), (s1,s2,...,sn), ...                   "
    it = iter(seq)
    result = tuple(islice(it, n))
    if len(result) == n:
        yield result
    for elem in it:
        result = result[1:] + (elem,)
        yield result

if __name__ == '__main__':
    if len(sys.argv) < 2:
        print '{0} <json file1> <file2> [file3 ...]'.format(os.path.basename(
            sys.argv[0]
        ))
        print "\tNeeds at least two JSON files to compare."
        print "\tWhen given that will then proceed to show new/removed friends"
        exit(1)

    friend_list = {}
    file_names = {}
    names = {}

    for i, file_name in enumerate(sys.argv[1:]):
        friend_list[i] = set()
        file_names[i] = file_name
        with open(file_name) as f:
            for val in json.load(f)['data']:
                names[val['id']] = val['name']
                friend_list[i].add(val['id'])

    keys = friend_list.keys()
    for (first, second) in window(keys, 2):
        diff = friend_list[first] - friend_list[second]
        if len(diff) > 0:
            print 'Difference between {0} and {1}:'.format(file_names[first],
                                                           file_names[second])
            for so_called_friend in diff:
                print '* {0} (http://facebook.com/profile.php?id={1})'.format(
                    names[so_called_friend],
                    so_called_friend
                )